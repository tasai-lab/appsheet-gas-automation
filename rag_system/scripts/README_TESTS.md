# RAGåŒ»ç™‚ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ - ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€RAGåŒ»ç™‚ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®æ¤œè¨¼ãƒ»ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€è¦§

| Phase | ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ç›®çš„ | å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|-------|-----------|------|--------------|
| 4.3x-9/10 | `validate_vectorization.py` | ãƒ™ã‚¯ãƒˆãƒ«åŒ–æ¤œè¨¼ï¼ˆsource_id/client_idã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ï¼‰ | ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Œäº†å¾Œ |
| 5.1 | `e2e_integration_test.py` | ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆæ¤œç´¢ãƒ»ãƒãƒ£ãƒƒãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰ | ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼åˆæ ¼å¾Œ |
| 5.2 | `accuracy_evaluation.py` | ç²¾åº¦è©•ä¾¡ï¼ˆNDCG@10ã€QAç²¾åº¦ï¼‰ | çµ±åˆãƒ†ã‚¹ãƒˆåˆæ ¼å¾Œ |
| 5.3 | `performance_test.py` | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã€ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼‰ | ç²¾åº¦è©•ä¾¡åˆæ ¼å¾Œ |

---

## ğŸš€ å®Ÿè¡Œæ‰‹é †

### å‰ææ¡ä»¶

1. **ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Œäº†**:
   ```bash
   # ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
   # é€²æ—ç¢ºèª: vectorization_fixed.log ã‚’å‚ç…§
   ```

2. **Backend/Frontendèµ·å‹•**:
   ```bash
   # Backendèµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ8000ï¼‰
   cd rag_system/backend && python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

   # Frontendèµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ3000ï¼‰
   cd rag_system/frontend && npm run dev
   ```

---

### Phase 4.3x-9/10: ãƒ™ã‚¯ãƒˆãƒ«åŒ–æ¤œè¨¼

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:**
```bash
cd /Users/t.asai/code/appsheet-gas-automation/rag_system
python3 scripts/validate_vectorization.py
```

**æ¤œè¨¼å†…å®¹:**
- âœ… source_id/user_id ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ­£ã—ãæŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ã‹
- âœ… KnowledgeBase ã¨ Embeddings ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹
- âœ… ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹åˆ¥ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°çµ±è¨ˆ

**åˆæ ¼åŸºæº–:**
- source_id/user_id æœ‰åŠ¹ç‡ >= 95%
- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: KnowledgeBase â‰ˆ Embeddingsï¼ˆå·®åˆ† <= 5ä»¶ï¼‰

---

### Phase 5.1: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆ

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:**
```bash
cd /Users/t.asai/code/appsheet-gas-automation/rag_system
python3 scripts/e2e_integration_test.py
```

**ãƒ†ã‚¹ãƒˆå†…å®¹:**
1. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
2. åˆ©ç”¨è€…ä¸€è¦§å–å¾—
3. ãƒ•ã‚£ãƒ«ã‚¿ãªã—æ¤œç´¢
4. ãƒ•ã‚£ãƒ«ã‚¿ã‚ã‚Šæ¤œç´¢ï¼ˆåˆ©ç”¨è€…æŒ‡å®šï¼‰
5. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãªã—ãƒãƒ£ãƒƒãƒˆ
6. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚ã‚Šãƒãƒ£ãƒƒãƒˆï¼ˆRAGï¼‰
7. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ æ¸¬å®š

**åˆæ ¼åŸºæº–:**
- å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼ˆå¤±æ•— = 0ï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  < 3ç§’

---

### Phase 5.2: ç²¾åº¦è©•ä¾¡

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:**
```bash
cd /Users/t.asai/code/appsheet-gas-automation/rag_system
python3 scripts/accuracy_evaluation.py
```

**è©•ä¾¡å†…å®¹:**
- **NDCG@10**: æ¤œç´¢ç²¾åº¦è©•ä¾¡
  - ãƒ†ã‚¹ãƒˆã‚¯ã‚¨ãƒª: è¨ªå•çœ‹è­·è¨ˆç”»ã€åˆ©ç”¨è€…åŸºæœ¬æƒ…å ±ã€é€šè©±è¨˜éŒ²è¦ç´„ãªã©
  - æœŸå¾…ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»ã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã¨ã®ä¸€è‡´åº¦
- **QAç²¾åº¦**: è³ªç–‘å¿œç­”ç²¾åº¦è©•ä¾¡
  - å›ç­”å†…å®¹ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹

**åˆæ ¼åŸºæº–:**
- NDCG@10 >= 0.6
- QAç²¾åº¦ >= 0.5
- ç·åˆã‚¹ã‚³ã‚¢ >= 0.7

---

### Phase 5.3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:**
```bash
cd /Users/t.asai/code/appsheet-gas-automation/rag_system
python3 scripts/performance_test.py
```

**æ¸¬å®šå†…å®¹:**
- **ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¸¬å®š**:
  - æœ€å°/æœ€å¤§/å¹³å‡/ä¸­å¤®å€¤/P95
- **ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ¸¬å®š**:
  - ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°: 5
  - æ¸¬å®šæ™‚é–“: 10ç§’
  - æˆåŠŸç‡ã€ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆreq/sï¼‰
- **ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ**:
  - ä¸¦è¡Œæ•°: 1, 5, 10, 15, 20
  - æœ€é©ä¸¦è¡Œæ•°ã®æ¨å®š

**åˆæ ¼åŸºæº–:**
- å¹³å‡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· < 1000ms
- ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ >= 5 req/s
- æˆåŠŸç‡ >= 99%

---

## ğŸ“Š å®Ÿè¡Œçµæœã®ç¢ºèª

å„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿè¡Œçµæœã‚’æ¨™æº–å‡ºåŠ›ã«è¡¨ç¤ºã—ã¾ã™ã€‚æœ€çµ‚è¡Œã«ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

- âœ… `Phase X.X: ã€‡ã€‡åˆæ ¼ï¼` â†’ æ¬¡ã®Phaseã¸é€²ã‚ã¾ã™
- âš ï¸ `Phase X.X: æ”¹å–„ã‚’æ¨å¥¨` â†’ æ¨å¥¨ãƒ¬ãƒ™ãƒ«ã®æ”¹å–„ãŒå¿…è¦
- âŒ `Phase X.X: ä¸åˆæ ¼` â†’ å•é¡Œã‚’ä¿®æ­£ã—ã¦ãã ã•ã„

---

## ğŸ”„ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

å…¨ãƒ†ã‚¹ãƒˆã‚’ä¸€æ‹¬å®Ÿè¡Œã™ã‚‹å ´åˆ:

```bash
#!/bin/bash
# run_all_tests.sh

cd /Users/t.asai/code/appsheet-gas-automation/rag_system

echo "========================================"
echo "Phase 4.3x-9/10: ãƒ™ã‚¯ãƒˆãƒ«åŒ–æ¤œè¨¼"
echo "========================================"
python3 scripts/validate_vectorization.py || exit 1

echo ""
echo "========================================"
echo "Phase 5.1: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆ"
echo "========================================"
python3 scripts/e2e_integration_test.py || exit 1

echo ""
echo "========================================"
echo "Phase 5.2: ç²¾åº¦è©•ä¾¡"
echo "========================================"
python3 scripts/accuracy_evaluation.py || exit 1

echo ""
echo "========================================"
echo "Phase 5.3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"
echo "========================================"
python3 scripts/performance_test.py || exit 1

echo ""
echo "ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆå®Œäº†ï¼Phase 4.4ï¼ˆVercelãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰ã¸é€²ã‚ã¾ã™"
```

**å®Ÿè¡Œ:**
```bash
chmod +x scripts/run_all_tests.sh
./scripts/run_all_tests.sh
```

---

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1. Backendæ¥ç¶šã‚¨ãƒ©ãƒ¼

```
âŒ æ¤œç´¢å¤±æ•—: Connection refused
```

**è§£æ±ºç­–:**
```bash
# Backendèµ·å‹•ç¢ºèª
curl http://localhost:8000/health

# èµ·å‹•ã—ã¦ã„ãªã„å ´åˆ
cd rag_system/backend && python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 2. ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãƒ‡ãƒ¼ã‚¿ãªã—

```
âš ï¸ KnowledgeBaseãŒç©ºã§ã™
```

**è§£æ±ºç­–:**
```bash
# ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Ÿè¡Œ
cd rag_system && python3 scripts/vectorize_existing_data.py --all --batch-size 30
```

### 3. ç²¾åº¦è©•ä¾¡ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸ä¸€è‡´

```
âš ï¸ æ”¹å–„ä½™åœ°ã‚ã‚Šï¼ˆç²¾åº¦ < 0.5ï¼‰
```

**è§£æ±ºç­–:**
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆèª¿æ•´ï¼ˆbackend/app/services/chat_service.pyï¼‰
- ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãƒ‡ãƒ¼ã‚¿ã®å“è³ªç¢ºèª
- æ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

---

## ğŸ“ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®ãƒ­ã‚°ã¯ä»¥ä¸‹ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š

- `vectorization_fixed.log`: ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãƒ­ã‚°
- å„ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ¨™æº–å‡ºåŠ›: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ç¢ºèª

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [RAG_SYSTEM_ARCHITECTURE.md](../docs/RAG_SYSTEM_ARCHITECTURE.md): ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [PHASE_PROGRESS_2025-10-27.md](../docs/PHASE_PROGRESS_2025-10-27.md): ãƒ•ã‚§ãƒ¼ã‚ºé€²æ—ç®¡ç†
- [CLAUDE.md](../.claude/CLAUDE.md): ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®é–‹ç™ºã‚¬ã‚¤ãƒ‰
