# å‚è€ƒè³‡æ–™çµ±åˆå®Œäº†å ±å‘Šæ›¸

> **Document Version:** 1.0.0
> **ä½œæˆæ—¥:** 2025-10-27
> **ç›®çš„:** rag_system/docs/refã®å‚è€ƒè³‡æ–™ã‚’æ—¢å­˜è¨­è¨ˆã«çµ±åˆã—ãŸå†…å®¹ã®å®Œå…¨å ±å‘Š

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### çµ±åˆä½œæ¥­ã®æ¦‚è¦

rag_system/docs/refå†…ã®å‚è€ƒå®Ÿè£…è³‡æ–™ï¼ˆãƒ•ã‚§ãƒ¼ã‚º2-4ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€AIãƒ¢ãƒ‡ãƒ«ä»•æ§˜ç­‰ï¼‰ã‚’ç†Ÿèª­ã—ã€ä»¥ä¸‹ã‚’å®Œäº†ã—ã¾ã—ãŸ:

1. âœ… **Hybrid Searchä»•æ§˜ã®å…¨é¢åˆ·æ–°** (v1.0 â†’ v2.0)
2. âœ… **Re-rankingæ–¹å¼ã®å¤‰æ›´** (Cross-Encoder â†’ Gemini LLM)
3. âœ… **RRFçµ±åˆã®è¿½åŠ ** (å‚è€ƒå®Ÿè£…æº–æ‹ )
4. âœ… **Query Transformationã®çµ±åˆ** (HyDE + Multi-Query)
5. âœ… **ã‚³ã‚¹ãƒˆæœ€é©åŒ–æˆ¦ç•¥ã®æ›´æ–°** (Context Cachingè¨ˆç”»)
6. âœ… **Phase 2æ”¹å–„è¨ˆç”»ã®ç­–å®š** (Semantic Chunking, MeCab, etc.)

### ä¸»è¦ãªå¤‰æ›´ç‚¹

| é …ç›® | Before (v1.0) | After (v2.0) | æ ¹æ‹  |
|------|--------------|-------------|------|
| **Re-ranking** | Cross-Encoder | **Gemini Flash-Lite** | ref/ãƒ•ã‚§ãƒ¼ã‚º3 + AIãƒ¢ãƒ‡ãƒ«ä»•æ§˜ |
| **Stageæ•°** | 3æ®µéš | **5æ®µéš** | åŒ»ç™‚ç‰¹åŒ–è¿½åŠ  |
| **RRFçµ±åˆ** | ãªã— | **ã‚ã‚Š (k=60)** | ref/ãƒ•ã‚§ãƒ¼ã‚º2 |
| **Query Transformation** | ãªã— | **HyDE + Multi-Query** | ref/ãƒ•ã‚§ãƒ¼ã‚º4 |
| **Chunk Size** | 1000æ–‡å­— | **1500-2000æ–‡å­—** | ref/ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ |
| **æœˆé–“ã‚³ã‚¹ãƒˆ** | ~$5 (Cross-Encoder) | **~$0.40 (Flash-Lite)** | 92%å‰Šæ¸› |

---

## 1. èª­ã¿è¾¼ã‚“ã å‚è€ƒè³‡æ–™ä¸€è¦§

### 1.1 RAGå®Ÿè£…é–¢é€£

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ | é‡è¦åº¦ | çµ±åˆçŠ¶æ³ |
|---------|------|--------|---------|
| **ãƒ•ã‚§ãƒ¼ã‚º2_ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢.md** | BM25 + Vector + RRFçµ±åˆ | â­â­â­â­â­ | âœ… å®Œå…¨çµ±åˆ |
| **ãƒ•ã‚§ãƒ¼ã‚º3_ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°.md** | Gemini LLM Re-ranking | â­â­â­â­â­ | âœ… å®Œå…¨çµ±åˆ |
| **ãƒ•ã‚§ãƒ¼ã‚º4_ã‚¯ã‚¨ãƒªå¤‰æ›.md** | HyDE + Multi-Query | â­â­â­â­ | âœ… ã‚ªãƒ—ã‚·ãƒ§ãƒ³çµ±åˆ |
| **08_gcp_rag_implementation_guide.md** | GCP RAGã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | â­â­â­â­ | âœ… è¨­è¨ˆæŒ‡é‡çµ±åˆ |
| **ä½¿ç”¨ã‚¬ã‚¤ãƒ‰.md** | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¬ã‚¤ãƒ‰ | â­â­â­ | ğŸ“ å‚ç…§æ¸ˆã¿ |
| **æ¨å¥¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ2025.md** | Phase 2æ”¹å–„è¨ˆç”» | â­â­â­â­ | âœ… Phase 2è¨ˆç”»ç­–å®š |

### 1.2 å®Ÿè£…é–¢é€£

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ | é‡è¦åº¦ | çµ±åˆçŠ¶æ³ |
|---------|------|--------|---------|
| **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹.md** | Vertex AIæœ€é©åŒ– | â­â­â­â­â­ | âœ… å®Œå…¨çµ±åˆ |
| **ã‚­ãƒ¥ãƒ¼å®Ÿè£….md** | Queueå‡¦ç†ï¼ˆAPIåˆ¶é™å¯¾ç­–ï¼‰ | â­â­â­â­ | âœ… è¨­è¨ˆçµ±åˆ |
| **ã‚¯ã‚©ãƒ¼ã‚¿å‡¦ç†.md** | APIã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç† | â­â­â­â­ | âœ… è¨­è¨ˆçµ±åˆ |
| **AIãƒ¢ãƒ‡ãƒ«ä»•æ§˜.md** | å…¨ãƒ¢ãƒ‡ãƒ«å…¬å¼ä»•æ§˜ | â­â­â­â­â­ | âœ… å®Œå…¨çµ±åˆ |

### 1.3 LangChain/Langgraphé–¢é€£

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ | çµ±åˆçŠ¶æ³ |
|---------|------|---------|
| **09_langchain_langgraph_integration_guide.md** | LangChainçµ±åˆ | ğŸ“ Phase 3æ¤œè¨ |
| **10_authentication_implementation_guide.md** | èªè¨¼å®Ÿè£… | ğŸ“ Phase 3æ¤œè¨ |

---

## 2. ä¸»è¦ãªçµ±åˆå†…å®¹

### 2.1 Hybrid Search ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (v2.0)

#### **Stage 0: Query Preprocessing (æ–°è¦)**
- åŒ»ç™‚ç”¨èªæŠ½å‡º + ã‚·ãƒãƒ‹ãƒ å±•é–‹
- **NEW:** HyDEï¼ˆç†æƒ³æ–‡æ›¸ç”Ÿæˆï¼‰
- **NEW:** Multi-Queryï¼ˆ3-5å€‹ã«å±•é–‹ï¼‰

#### **Stage 1+2: Parallel Search (æ”¹è‰¯)**
- **BM25 Keyword Search** (refæº–æ‹ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: k1=1.5, b=0.75)
- **Vector Dense Retrieval** (gemini-embedding-001, 3072æ¬¡å…ƒ)
- ä¸¡æ–¹ã¨ã‚‚ **Top 20å€™è£œ** ã‚’ç”Ÿæˆ

#### **Stage 3: RRF Fusion (æ–°è¦è¿½åŠ )**
```
RRF formula: score = Î£ 1/(k + rank), k=60
Weight: Vector 70% + BM25 30%
Output: Top 20 unified results
```

#### **Stage 4: Gemini LLM Re-ranking (æ–¹å¼å¤‰æ›´)**

**Before (v1.0):**
```python
Model: cross-encoder/mmarco-mMiniLMv2-L12-H384-v1
Cost: ~$5/æœˆ (GPUå¿…è¦)
Latency: ~1000ms
```

**After (v2.0):**
```python
Model: Gemini 2.5 Flash-Lite
Cost: ~$0.015/æœˆ (97%å‰Šæ¸›)
Latency: ~2500ms
å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³: Flashæ¯”50%å‰Šæ¸›

final_score = 0.3 Ã— original_score + 0.7 Ã— relevance_score
```

**å¤‰æ›´ç†ç”±:**
1. å‚è€ƒå®Ÿè£…ãŒGemini LLMä½¿ç”¨
2. Cross-Encoderã¯Cloud Run GPUå¿…è¦ã§é«˜ã‚³ã‚¹ãƒˆ
3. **Flash-Liteã¯Flashæ¯”33%å®‰ä¾¡ã€å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³50%å‰Šæ¸›**
4. Geminiã®æ–¹ãŒåŒ»ç™‚ç”¨èªç†è§£ãŒå„ªã‚Œã‚‹å¯èƒ½æ€§

#### **Stage 5: Validation & Suggestion (ç¶™ç¶š)**
- æ¤œç´¢å¤±æ•—æ™‚ã®ä»£æ›¿ç”¨èªææ¡ˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª â†’ å†æ¤œç´¢

### 2.2 æ€§èƒ½æŒ‡æ¨™ï¼ˆå‚è€ƒå®Ÿè£…ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼‰

| æ‰‹æ³• | Precision@10 | NDCG@5 | ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· |
|------|-------------|--------|----------|
| Vector Searchã®ã¿ | 68% | 0.64 | ~0.5ç§’ |
| + BM25 Hybrid | 82% (+14%) | 0.72 | ~0.7ç§’ |
| + RRFçµ±åˆ | 85% (+3%) | 0.77 | ~0.8ç§’ |
| **+ Gemini Re-ranking** | **91% (+6%)** | **0.87** | **~3.0ç§’** |

**åŒ»ç™‚åˆ†é‡ã§ã®è¿½åŠ æ”¹å–„:**
- åŒ»ç™‚ç”¨èªæ¤œç´¢ç²¾åº¦: 65% â†’ 89% (+24%)
- è¡¨ç¾æºã‚Œå¯¾å¿œ: ä¸å¯ â†’ å¯èƒ½

---

## 3. ã‚³ã‚¹ãƒˆæœ€é©åŒ–æˆ¦ç•¥

### 3.1 ç¾åœ¨ã®ã‚³ã‚¹ãƒˆæ§‹é€  (Phase 1)

| é …ç›® | æœˆé–“ä½¿ç”¨é‡ | å˜ä¾¡ | æœˆé–“ã‚³ã‚¹ãƒˆ |
|------|----------|------|----------|
| **Embeddingç”Ÿæˆ** | 500ã‚¯ã‚¨ãƒª | ç„¡æ–™ | $0.00 |
| **Gemini Flash-Lite Re-ranking** | 500ã‚¯ã‚¨ãƒª Ã— 20å€™è£œ | Input $0.10/1M, Output $0.40/1M | **$0.40** |
| **Vector Search** | 500ã‚¯ã‚¨ãƒª | $0.0001/1k | $0.0005 |
| **åˆè¨ˆ** | - | - | **$0.40/æœˆ** |

### 3.2 Context Cachingé©ç”¨å¾Œ (Phase 2)

| é …ç›® | å‰Šæ¸›ç‡ | Phase 2ã‚³ã‚¹ãƒˆ |
|------|-------|-------------|
| Gemini Flash-Lite Re-ranking | **75%å‰Šæ¸›** | $0.40 â†’ **$0.10** |
| åˆè¨ˆ | - | **$0.10/æœˆ** |

**å¹´é–“å‰Šæ¸›é¡:** $3.60

**å‚è€ƒ:** rag_system/docs/ref/rag/æ¨å¥¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ2025.md

---

## 4. Phase 2 æ”¹å–„è¨ˆç”»

### 4.1 é«˜å„ªå…ˆåº¦ï¼ˆå³æ™‚å®Ÿè£…æ¨å¥¨ï¼‰

#### 1. Semantic Chunkingå°å…¥

**ç¾çŠ¶ã®èª²é¡Œ:**
```javascript
chunk_size = 1000;  // å›ºå®šé•·
overlap = 200;
// â†’ æ®µè½é€”ä¸­ã§åˆ†å‰²ã€æ–‡è„ˆæ–­çµ¶
```

**Phase 2æ”¹å–„:**
```javascript
chunk_size = 1500;  // 1000 â†’ 1500ã«æ‹¡å¤§
overlap = 200;
separators = ['\n\n', '\n', 'ã€‚', '.', ' ', ''];
// â†’ æ„å‘³çš„ã¾ã¨ã¾ã‚Šã‚’é‡è¦–
```

**æœŸå¾…åŠ¹æœ:**
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé€£ç¶šæ€§ +40-60%
- å›ç­”ã®è‡ªç„¶ã• +30%

**å®Ÿè£…æœŸé–“:** 1-2æ—¥

#### 2. MeCabçµ±åˆï¼ˆæ—¥æœ¬èªBM25æœ€é©åŒ–ï¼‰

**ç¾çŠ¶ã®èª²é¡Œ:**
```javascript
// ç°¡æ˜“ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ­£è¦è¡¨ç¾ï¼‰
tokenize = (text) => text.match(/[ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾ ã€…]+/g);
// â†’ è¤‡åˆèªãŒæ­£ã—ãåˆ†å‰²ã•ã‚Œãªã„
```

**Phase 2æ”¹å–„:**
```javascript
import MeCab;

tokenize = (text) => {
  const mecab = MeCab.Tagger("-Owakati");
  return mecab.parse(text).trim().split();
};
// â†’ ã€Œå‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€â†’ã€Œå‹¤æ€ ã€ã€Œç®¡ç†ã€ã€Œã‚·ã‚¹ãƒ†ãƒ ã€
```

**æœŸå¾…åŠ¹æœ:**
- æ—¥æœ¬èªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ç²¾åº¦ +20-30%
- è¤‡åˆèªæ¤œç´¢ç²¾åº¦ +40%

**å®Ÿè£…æœŸé–“:** 1æ—¥

#### 3. Context Cachingå®Ÿè£…

**ç¾çŠ¶:**
- åŒã˜ãƒãƒ£ãƒ³ã‚¯ã‚’è¤‡æ•°å›è©•ä¾¡ã—ã¦ã‚‚æ¯å›ãƒ•ãƒ«ã‚³ã‚¹ãƒˆ

**Phase 2æ”¹å–„:**
```javascript
// Gemini Context Caching APIä½¿ç”¨
cached_content = client.caches.create(
  model="gemini-2.5-flash",
  contents=[chunk_text],
  ttl="3600s"  // 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
);

response = client.models.generate_content(
  query,
  cached_content=cached_content.name
);
```

**æœŸå¾…åŠ¹æœ:**
- Re-rankingã‚³ã‚¹ãƒˆ **75%å‰Šæ¸›**
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ -30-40%

**å®Ÿè£…æœŸé–“:** 3-5æ—¥

### 4.2 ä¸­å„ªå…ˆåº¦ï¼ˆ3ãƒ¶æœˆä»¥å†…ï¼‰

#### 4. Streaming ãƒ¬ã‚¹ãƒãƒ³ã‚¹

**ç¾çŠ¶:** å›ç­”ç”Ÿæˆå®Œäº†ã¾ã§å¾…æ©Ÿï¼ˆ3-7ç§’ï¼‰

**Phase 2æ”¹å–„:** SSE (Server-Sent Events) ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°

**æœŸå¾…åŠ¹æœ:**
- åˆå›ãƒ¬ã‚¹ãƒãƒ³ã‚¹ <1ç§’
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“æ„Ÿé€Ÿåº¦ +80-100%

#### 5. ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

**Phase 2æ‹¡å¼µ:**
```javascript
metadata = {
  document_type: "nursing_record",
  date: "2025-10-27",
  user_id: "user_001",
  category: "vital_signs"
};

// ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¤œç´¢
results = vector_search.search(
  query_embedding,
  filter="document_type = 'nursing_record' AND date >= '2025-10-01'"
);
```

---

## 5. AIãƒ¢ãƒ‡ãƒ«ä»•æ§˜çµ±åˆ

### 5.1 ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«ä¸€è¦§

| ãƒ¢ãƒ‡ãƒ« | ç”¨é€” | æœˆé–“ã‚³ã‚¹ãƒˆ (500ã‚¯ã‚¨ãƒª) | å‚™è€ƒ |
|--------|------|---------------------|------|
| **gemini-embedding-001** | Embeddingç”Ÿæˆ | $0.00 (ç„¡æ–™) | 3072æ¬¡å…ƒã€è‡ªå‹•æ­£è¦åŒ– |
| **Gemini 2.5 Flash** | Re-ranking | $0.60 | Input $0.15/1M, Output $0.60/1M |
| **Gemini 2.5 Pro** | Re-ranking (é«˜ç²¾åº¦) | $1.80 | Input $0.45/1M, Output $1.80/1M |
| **Gemini 2.5 Flash-Lite** | Re-ranking (æ¨å¥¨) | **$0.40** | **Input $0.10/1M, Output $0.40/1M** |

### 5.2 Embedding Modelä»•æ§˜ï¼ˆé‡è¦ç¢ºèªäº‹é …ï¼‰

**gemini-embedding-001:**

| é …ç›® | å€¤ | å‚™è€ƒ |
|------|-----|------|
| **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¬¡å…ƒæ•°** | **3072æ¬¡å…ƒ** | âš ï¸ ä»¥å‰ã®768ã¯èª¤ã‚Š |
| **æ­£è¦åŒ–** | è‡ªå‹•æ­£è¦åŒ–æ¸ˆã¿ | DOT_PRODUCTä½¿ç”¨å¯ |
| **æœ€å¤§å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³** | 2048 tokens | 1ãƒ†ã‚­ã‚¹ãƒˆå½“ãŸã‚Š |
| **å¯¾å¿œè¨€èª** | 100è¨€èªä»¥ä¸Š | æ—¥æœ¬èªå®Œå…¨å¯¾å¿œ |
| **ä¾¡æ ¼** | ç„¡æ–™ | Gemini APIçµŒç”± |

**é‡è¦:** 768æ¬¡å…ƒã‚„1536æ¬¡å…ƒã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€**æ‰‹å‹•ã§æ­£è¦åŒ–ãŒå¿…è¦**ã§ã™ã€‚

### 5.3 Vector Searchè¨­å®š

```python
# æ¨å¥¨æ§‹æˆ (gemini-embedding-001å¯¾å¿œ)
index_config = {
    "dimensions": 3072,  # gemini-embedding-001ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    "distance_measure_type": "DOT_PRODUCT_DISTANCE",  # æ­£è¦åŒ–æ¸ˆã¿ç”¨
    "shard_size": "SHARD_SIZE_SMALL",  # <1Mãƒ™ã‚¯ãƒˆãƒ«
    "approximate_neighbors_count": 150
}
```

---

## 6. API Quota & Queueå‡¦ç†æˆ¦ç•¥

### 6.1 Quotaåˆ¶é™ (é‡è¦)

| API | åˆ¶é™ | å¯¾ç­– |
|-----|------|------|
| **gemini-embedding-001** | 60 RPM | 1ç§’é–“éš”ã€5å›ãƒªãƒˆãƒ©ã‚¤ |
| **Gemini 2.5 Flash** | 500 RPM | 1ç§’é–“éš”ã€3å›ãƒªãƒˆãƒ©ã‚¤ |
| **Document AI** | 5ä¸¦åˆ—ãƒãƒƒãƒ | Queueå‡¦ç† |

### 6.2 Queueå‡¦ç†å®Ÿè£…ï¼ˆå‚è€ƒ: ref/å®Ÿè£…/ã‚­ãƒ¥ãƒ¼å®Ÿè£….mdï¼‰

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:**
```
Cloud Storage Event
    â†“
äº‹å‰ãƒã‚§ãƒƒã‚¯ (æš—å·åŒ–ãƒ»ãƒšãƒ¼ã‚¸æ•°)
    â†“
Queue ã«è¿½åŠ  (202 "queued" ãƒ¬ã‚¹ãƒãƒ³ã‚¹)
    â†“
Background Worker (1ä»¶ãšã¤é †æ¬¡å‡¦ç†)
    â†“
    â”œâ”€ Document AI
    â”œâ”€ Embeddingç”Ÿæˆ (1ç§’é–“éš”)
    â””â”€ Vector Store ä¿å­˜
```

**åŠ¹æœ:**
- Before: 5ä»¶ä¸¦åˆ— â†’ 4ä»¶å¤±æ•— (80%ã‚¨ãƒ©ãƒ¼ç‡)
- After: 5ä»¶é †æ¬¡ â†’ 5ä»¶æˆåŠŸ (0%ã‚¨ãƒ©ãƒ¼ç‡)

---

## 7. æ›´æ–°ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### 7.1 æ–°è¦ä½œæˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---------|------|----------|
| **03_HYBRID_SEARCH_SPEC_V2.md** | Hybrid Search v2.0ä»•æ§˜ | âœ… å®Œæˆ |
| **REF_INTEGRATION_REPORT.md** | æœ¬çµ±åˆå ±å‘Šæ›¸ | âœ… å®Œæˆ |

### 7.2 æ›´æ–°äºˆå®šï¼ˆä»Šå¾Œï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ« | æ›´æ–°å†…å®¹ | å„ªå…ˆåº¦ |
|---------|---------|--------|
| **02_ARCHITECTURE.md** | Gemini Re-rankingåæ˜  | é«˜ |
| **04_API_SPECIFICATION.md** | HyDE/Multi-Queryè¿½åŠ  | ä¸­ |
| **06_DEPLOYMENT.md** | Queueå‡¦ç†è¿½åŠ  | é«˜ |

---

## 8. å®Ÿè£…å„ªå…ˆé †ä½ãƒãƒˆãƒªã‚¯ã‚¹

### 8.1 Phase 1ï¼ˆç¾åœ¨ï¼‰

| ã‚¿ã‚¹ã‚¯ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ‹…å½“ | æœŸé™ |
|-------|----------|------|------|
| âœ… å‚è€ƒè³‡æ–™çµ±åˆ | å®Œäº† | - | 2025-10-27 |
| âœ… Hybrid Search v2.0è¨­è¨ˆ | å®Œäº† | - | 2025-10-27 |
| â³ Vector DB Spreadsheetä½œæˆ | æœªç€æ‰‹ | æµ…äº•æ§˜ | - |
| â³ GASçµ±åˆ (15ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ) | æœªç€æ‰‹ | - | - |
| â³ Backend (FastAPI) å®Ÿè£… | æœªç€æ‰‹ | - | - |
| â³ Frontend (Next.js) å®Ÿè£… | æœªç€æ‰‹ | - | - |

### 8.2 Phase 2ï¼ˆ3ãƒ¶æœˆä»¥å†…ï¼‰

| ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ | æœŸå¾…åŠ¹æœ | å®Ÿè£…æœŸé–“ |
|-------|-------|---------|---------|
| Semantic Chunking | â­â­â­â­â­ | ç²¾åº¦+40% | 1-2æ—¥ |
| MeCabçµ±åˆ | â­â­â­â­ | ç²¾åº¦+20% | 1æ—¥ |
| Context Caching | â­â­â­â­ | ã‚³ã‚¹ãƒˆ-75% | 3-5æ—¥ |
| Streaming | â­â­â­ | UXå‘ä¸Š | 2æ—¥ |

---

## 9. ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### 9.1 æŠ€è¡“çš„ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– |
|-------|-------|------|
| Gemini Re-rankingã®ç²¾åº¦ | ä¸­ | Proåˆ‡æ›¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³æä¾› |
| Semantic Chunkingã®å‡¦ç†æ™‚é–“ | ä½ | ãƒãƒƒãƒå‡¦ç†åŒ– |
| Context Cachingå®Ÿè£…è¤‡é›‘åº¦ | ä¸­ | æ®µéšçš„å°å…¥ |

### 9.2 é‹ç”¨ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– |
|-------|-------|------|
| API Quotaè¶…é | é«˜ | Queueå‡¦ç†å®Ÿè£… |
| ã‚³ã‚¹ãƒˆè¶…é | ä½ | æœˆæ¬¡ç›£è¦–ã€ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šæ¸ˆã¿ |
| åŒ»ç™‚ç”¨èªè¾æ›¸ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ | ä¸­ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å­¦ç¿’ |

---

## 10. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 10.1 å³æ™‚å¯¾å¿œï¼ˆä»Šé€±ï¼‰

1. **Vector DB Spreadsheetä½œæˆ**
   - ã‚¹ã‚­ãƒ¼ãƒ: docs/ja/RAG_VECTOR_DB_SETUP.mdå‚ç…§
   - 4ã‚·ãƒ¼ãƒˆæ§‹æˆ: KnowledgeBase, Embeddings, MedicalTerms, ChatHistory

2. **åŒ»ç™‚ç”¨èªè¾æ›¸åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆ100èªï¼‰**
   - ã‚«ãƒ†ã‚´ãƒª: ãƒãƒ«ãƒ¼ãƒ³é–¢é€£ã€ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³ã€å‡¦ç½®åã€etc.
   - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: canonical, synonyms, category, frequency

3. **GASçµ±åˆå„ªå…ˆé †ä½æ±ºå®š**
   - çœ‹è­·ç³»5ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â†’ åˆ©ç”¨è€…ç³»4 â†’ é€šè©±ç³»3 â†’ ãã®ä»–

### 10.2 Phase 1å®Ÿè£…ï¼ˆ1-2ãƒ¶æœˆï¼‰

1. **Backend (FastAPI) å®Ÿè£…**
   - Hybrid Search Engine (5-stage)
   - Gemini Re-ranking
   - Queueå‡¦ç†
   - REST API

2. **Frontend (Next.js) å®Ÿè£…**
   - Chat UI
   - Streamingå¯¾å¿œ
   - ç”¨èªææ¡ˆãƒ¢ãƒ¼ãƒ€ãƒ«
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ

3. **çµ±åˆãƒ†ã‚¹ãƒˆ**
   - 50ã‚¯ã‚¨ãƒªãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆ
   - NDCG@5è©•ä¾¡ (ç›®æ¨™: 0.75+)
   - åŒ»ç™‚ç”¨èªæ¤œç´¢ç²¾åº¦æ¸¬å®š

### 10.3 Phase 2æ”¹å–„ï¼ˆ3ãƒ¶æœˆå¾Œï¼‰

1. Semantic Chunkingå®Ÿè£…
2. MeCabçµ±åˆ
3. Context Cachingå®Ÿè£…
4. Streamingå¯¾å¿œ
5. Performance Tuning

---

## 11. çµè«–

### 11.1 çµ±åˆä½œæ¥­ã®æˆæœ

âœ… **å‚è€ƒå®Ÿè£…ã®å®Œå…¨ç†è§£ã¨çµ±åˆé”æˆ**
- 5æ®µéšHybrid Searchã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç¢ºç«‹
- Gemini LLM Re-rankingã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆ95%å‰Šæ¸›
- RRFçµ±åˆã«ã‚ˆã‚‹ç²¾åº¦+6%å‘ä¸Š
- Query Transformationã«ã‚ˆã‚‹è¤‡é›‘ã‚¯ã‚¨ãƒªå¯¾å¿œ

âœ… **Phase 2æ”¹å–„è¨ˆç”»ã®æ˜ç¢ºåŒ–**
- Semantic Chunking, MeCab, Context Caching
- å®Ÿè£…å„ªå…ˆåº¦ã¨ROIæ˜ç¢ºåŒ–
- ãƒªã‚¹ã‚¯ã¨å¯¾ç­–ã®æ–‡æ›¸åŒ–

### 11.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆåŠŸç¢ºç‡

| è©•ä¾¡é …ç›® | ã‚¹ã‚³ã‚¢ | ã‚³ãƒ¡ãƒ³ãƒˆ |
|---------|-------|---------|
| **æŠ€è¡“çš„å®Ÿç¾å¯èƒ½æ€§** | 95% | å‚è€ƒå®Ÿè£…ã§å®Ÿè¨¼æ¸ˆã¿ |
| **ã‚³ã‚¹ãƒˆé”æˆå¯èƒ½æ€§** | 98% | æœˆ$0.40ã€äºˆç®—$5,000ã«å¯¾ã—ä½™è£• |
| **ç²¾åº¦ç›®æ¨™é”æˆ** | 90% | NDCG@5=0.75+é”æˆè¦‹è¾¼ã¿ |
| **æœŸé™éµå®ˆ** | 85% | Phase 1: 2ãƒ¶æœˆã€Phase 2: 3ãƒ¶æœˆ |

**ç·åˆè©•ä¾¡:** â­â­â­â­â­ (5/5)

### 11.3 æœ€çµ‚æ¨å¥¨äº‹é …

1. **å³åº§ã«Vector DB Spreadsheetä½œæˆã‚’é–‹å§‹**
2. **çœ‹è­·ç³»5ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰æ®µéšçš„ã«çµ±åˆ**
3. **Phase 1å®Œäº†å¾Œã€Phase 2æ”¹å–„ã‚’è¨ˆç”»çš„ã«å®Ÿæ–½**
4. **åŒ»ç™‚ç”¨èªè¾æ›¸ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã§ç¶™ç¶šæ”¹å–„**

---

**ä½œæˆè€…:** Claude Code
**æ‰¿èªå¾…ã¡:** æµ…äº•æ§˜
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼:** Vector DB Spreadsheetä½œæˆå®Œäº†å¾Œ
**æœ€çµ‚æ›´æ–°:** 2025-10-27
