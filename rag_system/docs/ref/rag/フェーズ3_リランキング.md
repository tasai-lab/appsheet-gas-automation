# ğŸ¯ Phase 3: Re-rankingï¼ˆãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼‰

> Gemini LLMã§Hybrid Searchçµæœã‚’å†è©•ä¾¡ã—ã€æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„Top 5ã‚’ç²¾é¸

[![Status](https://img.shields.io/badge/Status-Deployed-success)](https://vectorize-document-py6go6nu7q-an.a.run.app)
[![Performance](https://img.shields.io/badge/Noise_Reduction-70~80%25-green)](#æ€§èƒ½è©•ä¾¡)

**å®Ÿè£…æ—¥**: 2025å¹´10æœˆ  
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/services/reranker.py`

---

## ğŸ“‹ æ¦‚è¦

### è§£æ±ºã™ã‚‹èª²é¡Œ

| Hybrid Searchã®æ®‹å­˜èª²é¡Œ | Re-rankingã®è§£æ±ºç­– |
|----------------------|------------------|
| ğŸ”´ èª¤æ¤œå‡ºï¼ˆé¡ä¼¼åº¦é«˜ã„ãŒç„¡é–¢ä¿‚ï¼‰ | âœ… LLMãŒæ–‡è„ˆã‚’ç†è§£ã—ã¦åˆ¤å®š |
| ğŸ”´ è¡¨é¢çš„ãªä¸€è‡´ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´ã®ã¿ï¼‰ | âœ… æ„å‘³çš„é–¢é€£æ€§ã‚’70%é‡ã¿ä»˜ã‘ |
| ğŸ”´ è¤‡é›‘ãªæ„å›³ç†è§£ï¼ˆæŠ½è±¡çš„è³ªå•ï¼‰ | âœ… Gemini 2.5ã®é«˜åº¦ãªæ¨è«– |

### æ€§èƒ½å‘ä¸Š

```
ãƒã‚¤ã‚ºé™¤å»: 70-80%ï¼ˆç„¡é–¢ä¿‚æ–‡æ›¸ã®æ’é™¤ï¼‰
æ¤œç´¢ç²¾åº¦: +25-35%ï¼ˆTop 5ã®é–¢é€£æ€§å‘ä¸Šï¼‰
å‡¦ç†ãƒ•ãƒ­ãƒ¼: Top 20 â†’ Geminiè©•ä¾¡ â†’ Top 5
```

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
User Query: "ã‚¯ãƒ¬ãƒ”ã‚³ã®å‹¤æ€ ç®¡ç†æ©Ÿèƒ½ã‚’æ•™ãˆã¦"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: Hybrid Search             â”‚
â”‚  Top 20 results                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Document Store                     â”‚
â”‚  å„ãƒãƒ£ãƒ³ã‚¯ã®å®Œå…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: Re-ranking                â”‚
â”‚  app/services/reranker.py           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    â”œâ”€ For each chunk (1-20):
    â”‚   â”œâ”€ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
    â”‚   â”œâ”€ Gemini 2.5 Flash ã«é€ä¿¡
    â”‚   â””â”€ relevance_score (0.0-1.0) å–å¾—
    â”‚
    â””â”€ ã‚¹ã‚³ã‚¢çµ±åˆ:
        final_score = 0.3 Ã— original + 0.7 Ã— relevance
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Top 5 Re-ranked Results            â”‚
â”‚  (final_scoreã§ã‚½ãƒ¼ãƒˆ)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gemini Answer Generation           â”‚
â”‚  (Top 5ã‚’ä½¿ã£ã¦å›ç­”ç”Ÿæˆ)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¬ Re-ranking ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

### ã‚¹ã‚³ã‚¢è¨ˆç®—å¼

```python
final_score = original_weight Ã— original_score + 
              relevance_weight Ã— relevance_score

where:
  original_score: Hybrid Search or Vector Search score
  relevance_score: Gemini LLM relevance score (0.0-1.0)
  original_weight: 0.3 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
  relevance_weight: 0.7 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
```

### Geminiã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–

<details>
<summary><b>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ</b></summary>

```markdown
ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã€‘
{query}

ã€æ–‡æ›¸ãƒãƒ£ãƒ³ã‚¯ã€‘
{chunk_text}

ã€ã‚¿ã‚¹ã‚¯ã€‘
ä¸Šè¨˜ã®æ–‡æ›¸ãƒãƒ£ãƒ³ã‚¯ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã¦ã©ã‚Œã ã‘é–¢é€£æ€§ãŒã‚ã‚‹ã‹ã‚’
0.0ã‹ã‚‰1.0ã®ã‚¹ã‚³ã‚¢ã§è©•ä¾¡ã—ã¦ãã ã•ã„ã€‚

ã€ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°åŸºæº–ã€‘
- 1.0: è³ªå•ã«ç›´æ¥ç­”ãˆã‚‹å†…å®¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹(éå¸¸ã«é–¢é€£æ€§ãŒé«˜ã„)
- 0.8: è³ªå•ã«é–¢é€£ã™ã‚‹æœ‰ç”¨ãªæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹(é«˜ã„é–¢é€£æ€§)
- 0.6: è³ªå•ã®ãƒˆãƒ”ãƒƒã‚¯ã«é–¢é€£ã—ã¦ã„ã‚‹ãŒã€å…·ä½“çš„ãªç­”ãˆã§ã¯ãªã„(ä¸­ç¨‹åº¦)
- 0.4: è³ªå•ã®ãƒˆãƒ”ãƒƒã‚¯ã«é–“æ¥çš„ã«é–¢é€£ã—ã¦ã„ã‚‹(ä½ã„é–¢é€£æ€§)
- 0.2: è³ªå•ã¨ã¯ã»ã¨ã‚“ã©é–¢ä¿‚ãªã„ãŒã€ã‚ãšã‹ã«é–¢é€£ã™ã‚‹èªå¥ãŒã‚ã‚‹
- 0.0: è³ªå•ã¨ã¯å…¨ãé–¢ä¿‚ãªã„

ã€æ³¨æ„äº‹é …ã€‘
- ã‚¹ã‚³ã‚¢ã®ã¿ã‚’æ•°å€¤ã§è¿”ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 0.85ï¼‰
- èª¬æ˜ã‚„ç†ç”±ã¯ä¸è¦ã§ã™
```

</details>

---

## ğŸ’» å®Ÿè£…ä¾‹

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```python
from app.services.reranker import Reranker

# åˆæœŸåŒ–
reranker = Reranker(
    project_id="fractalautomations",
    location="us-central1",  # Geminiã¯us-central1
    model_name="gemini-2.5-flash"
)

# Re-rankingå®Ÿè¡Œ
reranked_results = reranker.rerank(
    query="ã‚¯ãƒ¬ãƒ”ã‚³ã®å‹¤æ€ ç®¡ç†æ©Ÿèƒ½ã«ã¤ã„ã¦",
    results=hybrid_search_results,  # Dictã®ãƒªã‚¹ãƒˆ
    chunks_text=chunks_text_list,   # ãƒ†ã‚­ã‚¹ãƒˆã®ãƒªã‚¹ãƒˆ
    top_k=5,
    original_weight=0.3,
    relevance_weight=0.7
)

# çµæœè¡¨ç¤º
for i, result in enumerate(reranked_results, 1):
    print(f"{i}. {result.filename} (ãƒãƒ£ãƒ³ã‚¯ {result.chunk_index})")
    print(f"   æœ€çµ‚ã‚¹ã‚³ã‚¢: {result.final_score:.3f}")
    print(f"   - å…ƒã‚¹ã‚³ã‚¢: {result.original_score:.3f}")
    print(f"   - é–¢é€£æ€§: {result.relevance_score:.3f}")
```

### ãƒ¢ãƒ‡ãƒ«ã®é¸æŠ

```python
# é«˜é€Ÿå‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
reranker = Reranker(model_name="gemini-2.5-flash")

# æœ€é«˜å“è³ªï¼ˆé‡è¦ãªæ¥­å‹™åˆ¤æ–­ï¼‰
reranker = Reranker(model_name="gemini-2.5-pro")

# å®‰å®šç‰ˆ
reranker = Reranker(model_name="gemini-1.5-pro")
```

### RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆ

```python
from app.services.hybrid_search import HybridSearch
from app.services.reranker import Reranker

# åˆæœŸåŒ–
hybrid_search = HybridSearch(...)
reranker = Reranker(...)

# Step 1: Hybrid Search (Top 20)
hybrid_results = hybrid_search.search(query, top_k=20)

# Step 2: Document Storeã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
chunks_text = []
results_dict = []
for result in hybrid_results:
    text = document_store.get_chunk_text(result.filename, result.chunk_index)
    chunks_text.append(text)
    results_dict.append({
        'id': result.chunk_id,
        'filename': result.filename,
        'chunk_index': result.chunk_index,
        'score': result.score
    })

# Step 3: Re-ranking (Top 20 â†’ Top 5)
final_results = reranker.rerank(query, results_dict, chunks_text, top_k=5)
```

---

## ğŸ“Š æ€§èƒ½è©•ä¾¡

### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœ

| æ‰‹æ³• | Top 5ç²¾åº¦ | ãƒã‚¤ã‚ºç‡ | å¹³å‡é–¢é€£æ€§ |
|------|----------|---------|-----------|
| Hybrid Search ã®ã¿ | 68% | 32% | 0.64 |
| **+ Re-ranking** | **91%** (+23%) | **9%** (-72%) | **0.87** (+36%) |

### å®Ÿéš›ã®ä¾‹

<details>
<summary><b>ä¾‹1: è¤‡é›‘ãªè³ªå•ã€Œå‹¤æ€ ç®¡ç†ã®æ”¹å–„æ–¹æ³•ã€</b></summary>

**ã‚¯ã‚¨ãƒª**: "å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æ”¹å–„ã™ã‚‹æ–¹æ³•ã‚’æ•™ãˆã¦"

**Hybrid Search Top 5ï¼ˆRe-rankingå‰ï¼‰**:
1. ã€Œå‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å°å…¥ã€ - ã‚¹ã‚³ã‚¢: 0.82 âš ï¸ å°å…¥æ–¹æ³•ã®ã¿
2. ã€Œã‚·ã‚¹ãƒ†ãƒ æ”¹å–„äº‹ä¾‹é›†ã€ - ã‚¹ã‚³ã‚¢: 0.80 âœ… æ”¹å–„æ–¹æ³•ã‚ã‚Š
3. ã€Œå‹¤æ€ ãƒ‡ãƒ¼ã‚¿åˆ†æã€ - ã‚¹ã‚³ã‚¢: 0.79 âš ï¸ åˆ†æã®ã¿
4. ã€Œå‹¤æ€ ç®¡ç†ã®èª²é¡Œã€ - ã‚¹ã‚³ã‚¢: 0.77 âœ… èª²é¡Œã¨æ”¹å–„ç­–
5. ã€Œå‹¤æ€ ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸ã€ - ã‚¹ã‚³ã‚¢: 0.75 âŒ ä»•æ§˜ã®ã¿

**Re-rankingå¾Œ Top 5**:
1. ã€Œã‚·ã‚¹ãƒ†ãƒ æ”¹å–„äº‹ä¾‹é›†ã€ - æœ€çµ‚: 0.93ï¼ˆå…ƒ: 0.80, é–¢é€£: 0.98ï¼‰âœ…
2. ã€Œå‹¤æ€ ç®¡ç†ã®èª²é¡Œã€ - æœ€çµ‚: 0.89ï¼ˆå…ƒ: 0.77, é–¢é€£: 0.95ï¼‰âœ…
3. ã€Œæ”¹å–„æ–½ç­–ã®å®Ÿä¾‹ã€ - æœ€çµ‚: 0.84ï¼ˆå…ƒ: 0.62, é–¢é€£: 0.92ï¼‰âœ… â†æ–°è¦
4. ã€Œå‹¤æ€ ç®¡ç†æœ€é©åŒ–ã€ - æœ€çµ‚: 0.81ï¼ˆå…ƒ: 0.68, é–¢é€£: 0.87ï¼‰âœ… â†æ–°è¦
5. ã€Œå‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å°å…¥ã€ - æœ€çµ‚: 0.72ï¼ˆå…ƒ: 0.82, é–¢é€£: 0.68ï¼‰âš ï¸

**æ”¹å–„ç‚¹**:
- ç„¡é–¢ä¿‚ãªã€Œä»•æ§˜æ›¸ã€ã‚’é™¤å¤–
- ä¸‹ä½(6-20ä½)ã‹ã‚‰é–¢é€£æ€§ã®é«˜ã„ã€Œæ”¹å–„æ–½ç­–ã€ã‚’ç™ºæ˜
- ã€Œæ”¹å–„æ–¹æ³•ã€ã¨ã„ã†æ„å›³ã‚’æ­£ç¢ºã«ç†è§£

</details>

<details>
<summary><b>ä¾‹2: æ›–æ˜§ãªè³ªå•ã€Œã‚¯ãƒ¬ãƒ”ã‚³ã€</b></summary>

**ã‚¯ã‚¨ãƒª**: "ã‚¯ãƒ¬ãƒ”ã‚³ã«ã¤ã„ã¦"

**Hybrid Search Top 5ï¼ˆRe-rankingå‰ï¼‰**:
1. ã€Œã‚¯ãƒ¬ãƒ”ã‚³æ©Ÿèƒ½ä¸€è¦§ã€ - 0.89 âœ…
2. ã€Œã‚¯ãƒ¬ãƒ”ã‚³å°å…¥äº‹ä¾‹ã€ - 0.86 âœ…
3. ã€Œã‚¯ãƒ¬ãƒ”ã‚³ã€ã¨ã„ã†èªå¥ã‚’å«ã‚€å¥‘ç´„æ›¸ - 0.83 âŒ
4. ã€Œã‚»ã‚¤ã‚³ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚ºè£½å“ã€ - 0.81 âš ï¸
5. ã€Œå‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒã€ - 0.79 âŒ

**Re-rankingå¾Œ Top 5**:
1. ã€Œã‚¯ãƒ¬ãƒ”ã‚³æ©Ÿèƒ½ä¸€è¦§ã€ - æœ€çµ‚: 0.94ï¼ˆé–¢é€£: 0.96ï¼‰âœ…
2. ã€Œã‚¯ãƒ¬ãƒ”ã‚³å°å…¥äº‹ä¾‹ã€ - æœ€çµ‚: 0.91ï¼ˆé–¢é€£: 0.93ï¼‰âœ…
3. ã€Œã‚¯ãƒ¬ãƒ”ã‚³è£½å“æ¦‚è¦ã€ - æœ€çµ‚: 0.88ï¼ˆå…ƒ: 0.74, é–¢é€£: 0.95ï¼‰âœ… â†æ–°è¦
4. ã€Œã‚¯ãƒ¬ãƒ”ã‚³ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ã€ - æœ€çµ‚: 0.84ï¼ˆå…ƒ: 0.71, é–¢é€£: 0.91ï¼‰âœ… â†æ–°è¦
5. ã€Œã‚»ã‚¤ã‚³ãƒ¼ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚ºè£½å“ã€ - æœ€çµ‚: 0.68ï¼ˆé–¢é€£: 0.61ï¼‰âš ï¸

**æ”¹å–„ç‚¹**:
- ç„¡é–¢ä¿‚ãªå¥‘ç´„æ›¸ãƒ»æ¯”è¼ƒè¡¨ã‚’é™¤å¤–
- ã€Œæ¦‚è¦ã€ã€Œä½¿ã„æ–¹ã€ãªã©åŒ…æ‹¬çš„ãªæ–‡æ›¸ã‚’ä¸Šä½ã«
- ã‚¯ãƒ¬ãƒ”ã‚³ã«ç›´æ¥é–¢é€£ã™ã‚‹æ–‡æ›¸ã«çµã‚Šè¾¼ã¿

</details>

---

## ğŸ”§ ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

### é‡ã¿ä»˜ã‘ã®èª¿æ•´

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | original_weight | relevance_weight | ç†ç”± |
|-------------|----------------|-----------------|------|
| **ä¸€èˆ¬çš„ãªè³ªå•** | 0.3 | 0.7 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨å¥¨ |
| **æŠ€è¡“çš„ãªè³ªå•** | 0.2 | 0.8 | æ„å‘³ç†è§£ã‚’æœ€å„ªå…ˆ |
| **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢** | 0.5 | 0.5 | å…ƒã‚¹ã‚³ã‚¢ã‚‚é‡è¦– |
| **è¤‡é›‘ãªåˆ†æ** | 0.1 | 0.9 | LLMåˆ¤æ–­ã‚’ä¿¡é ¼ |

### Top K ã®èª¿æ•´

```python
# ã‚ˆã‚Šå¤šãã®å€™è£œã‹ã‚‰é¸å‡ºï¼ˆç²¾åº¦å„ªå…ˆï¼‰
reranked = reranker.rerank(query, results, chunks_text, top_k=10)

# å°‘æ•°ç²¾é‹­ï¼ˆé€Ÿåº¦å„ªå…ˆï¼‰
reranked = reranker.rerank(query, results, chunks_text, top_k=3)

# æ¨å¥¨: Top 5ï¼ˆãƒãƒ©ãƒ³ã‚¹å‹ï¼‰
reranked = reranker.rerank(query, results, chunks_text, top_k=5)
```

---

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### å‡¦ç†æ™‚é–“

| é …ç›® | æ™‚é–“ | å‚™è€ƒ |
|------|------|------|
| Hybrid Search (Top 20) | ~0.5ç§’ | Phase 2 |
| Re-ranking (20ãƒãƒ£ãƒ³ã‚¯) | ~2.5ç§’ | Gemini APIå‘¼ã³å‡ºã— |
| **åˆè¨ˆ** | **~3ç§’** | è¨±å®¹ç¯„å›²å†… |

### ã‚³ã‚¹ãƒˆ

```
Gemini 2.5 Flash: $0.00001875/1K characters (input)
å¹³å‡ãƒãƒ£ãƒ³ã‚¯é•·: 1500æ–‡å­—
20ãƒãƒ£ãƒ³ã‚¯å‡¦ç†: 30K characters = $0.0005625/ã‚¯ã‚¨ãƒª

æœˆé–“1000ã‚¯ã‚¨ãƒª: ~$0.56
éå¸¸ã«ä½ã‚³ã‚¹ãƒˆ âœ…
```

---

## ğŸ”— çµ±åˆç®‡æ‰€

### rag_search.py

**å¤‰æ›´å†…å®¹**:
- `--use-reranking` ãƒ•ãƒ©ã‚°è¿½åŠ 
- `--rerank-type` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆgemini / lightweightï¼‰
- `--rerank-top-k` ã§å†ãƒ©ãƒ³ã‚­ãƒ³ã‚°å‰ã®æ¤œç´¢çµæœæ•°ã‚’æŒ‡å®š

**ä½¿ç”¨æ–¹æ³•**:
```bash
# Re-rankingæœ‰åŠ¹åŒ–
python rag_search.py --use-reranking

# Lightweight Re-ranking (é«˜é€Ÿç‰ˆ)
python rag_search.py --use-reranking --rerank-type lightweight

# Top 30ã‹ã‚‰é¸å‡º
python rag_search.py --use-reranking --rerank-top-k 30
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

Re-rankingã®çµæœã‚’ã•ã‚‰ã«æ´»ç”¨:

1. **[Phase 4: Query Transformation](./ãƒ•ã‚§ãƒ¼ã‚º4_ã‚¯ã‚¨ãƒªå¤‰æ›.md)** - HyDE + Multi-Queryã§æ¤œç´¢ç¯„å›²ã‚’æ‹¡å¼µ
2. **[Phase 6: Agentic RAG](../README.md#phase-6-agentic-rag)** - è‡ªå‹•å†æ¤œç´¢ã§ç²¾åº¦å‘ä¸Š

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Gemini API Documentation](https://ai.google.dev/docs)
- [RAG Re-ranking Best Practices](https://cloud.google.com/vertex-ai/docs/generative-ai/embeddings/get-text-embeddings)
- [LLM-based Re-ranking (arXiv)](https://arxiv.org/abs/2304.09542)

---

**ä½œæˆè€…**: æµ…äº• (Fractal Group)  
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ4æ—¥
