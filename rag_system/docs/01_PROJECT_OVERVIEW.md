# プロジェクト概要書

## 1. プロジェクト基本情報

| 項目 | 内容 |
|-----|------|
| プロジェクト名 | 医療特化型RAGシステム (Medical RAG System) |
| プロジェクトコード | MED-RAG-001 |
| 開始日 | 2025-10-27 |
| 対象組織 | Fractal Group - 訪問看護・医療介護部門 |
| ステータス | Phase 1 完了 / Phase 2 開始準備 |

## 2. プロジェクト目的

### 2.1 背景

現在、15の独立したGASプロジェクトが以下のデータを生成・管理:
- 訪問看護記録 (通常記録、精神科記録、計画書、報告書)
- 通話記録 (要約、質疑応答)
- 利用者情報 (基本情報、質疑応答、フェースシート)
- 営業記録 (レポート、名刺)

累計13,500件以上のデータが存在するが、以下の課題がある:
- データが各AppSheetアプリに分散
- 横断的な検索が困難
- 医療用語の表現揺れによる検索漏れ
- 過去のケース参照に時間がかかる

### 2.2 目的

これらのデータをベクトル化し、以下を実現:
1. **統合検索**: 全ドメイン横断的な高精度検索
2. **医療用語対応**: シノニム辞書による表現揺れ吸収
3. **インタラクティブ提案**: 検索失敗時の代替用語提案
4. **ストリーミング応答**: リアルタイムなチャット体験
5. **ユーザー特化検索**: 特定利用者に絞った検索

### 2.3 成功指標

| KPI | 目標値 | 測定方法 |
|-----|--------|---------|
| 検索精度 (NDCG@5) | 0.75以上 | オフライン評価 (50クエリセット) |
| 医療用語適合率 | 90%以上 | シノニム辞書カバレッジ |
| ユーザー満足度 | 4.0以上 (5点満点) | 月次アンケート |
| 平均検索時間 | 3秒以内 | Application Insights |
| システム稼働率 | 99.5%以上 | Cloud Monitoring |

## 3. スコープ

### 3.1 対象範囲

#### データソース (15プロジェクト)

**Nursing (看護) - 5プロジェクト:**
1. `Appsheet_訪問看護_通常記録` - 通常の訪問看護記録
2. `Appsheet_訪問看護_精神科記録` - 精神科専門記録
3. `Appsheet_訪問看護_計画書問題点` - 看護計画書
4. `Appsheet_訪問看護_計画書問題点_評価` - 計画評価
5. `Appsheet_訪問看護_報告書` - 訪問報告書

**Clients (利用者) - 4プロジェクト:**
6. `Appsheet_利用者_基本情報上書き` - 基本情報管理
7. `Appsheet_利用者_質疑応答` - 利用者情報QA
8. `Appsheet_利用者_フェースシート` - フェースシート
9. `Appsheet_利用者_家族情報作成` - 家族情報

**Calls (通話) - 3プロジェクト:**
10. `Appsheet_通話_要約生成` - 通話音声→要約
11. `Appsheet_通話_質疑応答` - 通話記録QA
12. `Appsheet_ALL_スレッド更新` - スレッド管理

**Sales (営業) - 2プロジェクト:**
13. `Appsheet_営業レポート` - 営業活動記録
14. `Appsheet_名刺取り込み` - 名刺OCR管理

**Automation - 1プロジェクト:**
15. `Automation_レシート` - 経費管理

#### 機能範囲

**Phase 1 (完了):**
- [x] 共通モジュール実装 (embeddings_service, vector_db_sync)
- [x] テスト関数作成
- [x] セットアップドキュメント作成

**Phase 2 (進行中):**
- [ ] 15 GASプロジェクトへのRAG統合
- [ ] Vector DBスプレッドシート作成
- [ ] 既存データ初期移行 (13,500件)

**Phase 3:**
- [ ] Backend実装 (Cloud Run + FastAPI)
- [ ] Hybrid Search実装 (BM25 + Dense + Reranking)
- [ ] 医療用語シノニム処理

**Phase 4:**
- [ ] Frontend実装 (Vercel + Next.js)
- [ ] チャットUI
- [ ] ストリーミング応答
- [ ] 用語提案モーダル

**Phase 5:**
- [ ] 医療用語辞書構築 (100語初期版)
- [ ] UMLS/SNOMED CT統合

**Phase 6:**
- [ ] 統合テスト
- [ ] 精度評価 (NDCG, Recall@K)
- [ ] 負荷テスト

**Phase 7:**
- [ ] 本番環境デプロイ
- [ ] 運用監視設定
- [ ] ユーザートレーニング

### 3.2 対象外範囲

以下は本プロジェクトのスコープ外:
- 既存GASプロジェクトの機能変更
- AppSheetアプリのUI/UX変更
- 新規データソースの追加 (Phase 1では)
- リアルタイム同期 (バッチ同期のみ)
- 多言語対応 (日本語のみ)

## 4. ステークホルダー

| 役割 | 担当者/部門 | 責任範囲 |
|-----|------------|---------|
| プロジェクトオーナー | Fractal Group 経営層 | 予算承認、最終意思決定 |
| プロジェクトマネージャー | 開発チームリーダー | 進捗管理、リソース調整 |
| 技術リード | Claude Code / 浅井氏 | アーキテクチャ設計、実装 |
| エンドユーザー | 訪問看護師、ケアマネージャー | 要件提供、受入テスト |
| 医療専門家 | 看護師長、医師 | 医療用語辞書監修 |
| 運用チーム | IT部門 | 本番運用、監視、保守 |

## 5. 技術スタック

### 5.1 GAS Layer (既存)

| コンポーネント | 技術 |
|--------------|------|
| 実行環境 | Google Apps Script (V8 Runtime) |
| データストレージ | Google Spreadsheet |
| API認証 | OAuth2 (ScriptApp.getOAuthToken) |
| Webhook受信 | doPost関数 |

### 5.2 Embeddings & Generation

| コンポーネント | 技術 | 仕様 |
|--------------|------|------|
| Embedding Model | Vertex AI gemini-embedding-001 | 3072次元 |
| Generation Model | Vertex AI Gemini 2.5 Flash/Pro | 思考モード対応 |
| 認証 | OAuth2 | GCPサービスアカウント |
| プロジェクト | macro-shadow-458705-v8 | us-central1 |

### 5.3 Backend

| コンポーネント | 技術 | バージョン |
|--------------|------|-----------|
| 実行環境 | Cloud Run | Fully Managed |
| フレームワーク | FastAPI | 0.104+ |
| 言語 | Python | 3.11 |
| Vector検索 | Google Spreadsheet + NumPy | - |
| Reranking | Cross-Encoder (sentence-transformers) | - |
| ストリーミング | SSE (Server-Sent Events) | - |

### 5.4 Frontend

| コンポーネント | 技術 | バージョン |
|--------------|------|-----------|
| ホスティング | Vercel | - |
| フレームワーク | Next.js | 14 (App Router) |
| 言語 | TypeScript | 5+ |
| UIライブラリ | Tailwind CSS + shadcn/ui | - |
| 状態管理 | React Hooks | - |
| SSE Client | EventSource API | - |

### 5.5 Vector DB

| コンポーネント | 技術 |
|--------------|------|
| ストレージ | Google Spreadsheet |
| シート構成 | KnowledgeBase, Embeddings, MedicalTerms, ChatHistory |
| アクセス | Google Sheets API v4 |

## 6. 制約条件

### 6.1 技術的制約

- GAS実行時間制限: 6分/実行
- Spreadsheet行数制限: 約500万セル (実質~5万行推奨)
- Vertex AI Embeddings制限: 2048トークン/テキスト
- Cloud Run制限: メモリ8GB、タイムアウト3600秒

### 6.2 予算制約

- 月額コスト上限: $50
- 初期開発費: 人月換算2人月以内

### 6.3 スケジュール制約

- Phase 1-3: 2週間以内
- Phase 4-6: 3週間以内
- Phase 7: 1週間以内
- **総期間**: 6週間以内

## 7. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| Spreadsheet行数上限到達 | 高 | 中 | アーカイブ機能、Pinecone移行準備 |
| 医療用語辞書の不完全性 | 中 | 高 | 運用中の学習機能、専門家レビュー |
| Vertex AI APIコスト超過 | 中 | 低 | クォータ監視、Flash優先使用 |
| 検索精度不足 | 高 | 中 | Reranking強化、ファインチューニング検討 |
| GASデプロイ失敗 | 低 | 低 | deploy_unified.py使用、バックアップ |

## 8. 次のアクション

### 即時対応 (今週)
- [ ] Vector DBスプレッドシート作成
- [ ] 看護系5プロジェクトへのRAG統合
- [ ] Backend基盤構築開始

### 短期 (2週間以内)
- [ ] 全15プロジェクト統合完了
- [ ] Hybrid Search実装完了
- [ ] Frontend基盤構築完了

### 中期 (1ヶ月以内)
- [ ] 医療用語辞書100語登録
- [ ] 統合テスト・精度評価
- [ ] 本番デプロイ準備

---

**承認**:
- [ ] プロジェクトオーナー
- [ ] 技術リード
- [ ] エンドユーザー代表

**文書管理**:
- バージョン: 1.0
- 作成日: 2025-10-27
- 最終更新: 2025-10-27
- 次回レビュー: 2025-11-03
